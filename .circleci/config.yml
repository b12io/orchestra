version: 2
jobs:
  build:
    working_directory: ~/orchestra
    machine:
      image: default # Include Node.js & Yarn
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: |
            sudo apt-get update
            sudo apt-get install -y build-essential python3.12 python3.12-venv python3.12-dev curl
            sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.12 1
            sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 1
            curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
            sudo apt-get install -y nodejs
            npm install -g yarn
            yarn global add gulp
            yarn
            # Upgrade pip to latest version
            pip install --upgrade pip
            pip install -r requirements.txt
            pip install coveralls
      - run:
          name: Run tests
          command: |
            make lint
            make coverage
            make coveralls
